<div class="chat-container">
  <app-sidebar></app-sidebar>

  <main class="chat-window">
    <header class="chat-header">
      PERFIL DEL PACIENTE
    </header>

    <section class="messages perfil-section">
      <div class="message user perfil-bloque">
        <h3>Información del Usuario</h3>
        <div class="text">
          <strong>Usuario:</strong> {{ paciente.nombre }}<br />
          <strong>Correo:</strong> {{ paciente.email }}
        </div>
      </div>

      <!-- Botón de recomendación -->
      <div class="message user perfil-bloque">
        <button (click)="obtenerRecomendacion()" class="btn-recomendacion" [disabled]="loading">
          {{ loading ? 'Cargando...' : 'Recomendación de especialistas' }}
        </button>

        <div *ngIf="recomendacion" class="recomendacion-ia">
          <h4>Recomendación de la IA:</h4>
          <p>{{ recomendacion }}</p>
        </div>
      </div>

      <div class="message user perfil-bloque" *ngIf="especialistas.length > 0">
        <h3>Especialistas recomendados</h3>
        <ul>
          <li *ngFor="let especialista of especialistas">
            <strong>{{ especialista.usuario }}</strong> - {{ especialista.especialidad }}<br />
            <em>{{ especialista.correo }}</em>
          </li>
        </ul>
      </div>

      <!-- Resultados Big Five -->
      <div class="message user perfil-bloque">
        <h3>Resultados Big Five</h3>
        <div class="grafica-estadisticas" *ngIf="bigFiveResult">
          <div class="barra" *ngFor="let trait of bigFiveTraits">
            <span class="nombre">{{ trait.label }}</span>
            <div class="barra-base">
              <div class="barra-relleno"
                   [ngClass]="getColor(getTraitValue(trait.key))"
                   [style.width.%]="getWidth(getTraitValue(trait.key), 5)">
              </div>
            </div>
            <span class="valor">{{ getTraitValue(trait.key) | number:'1.2-2' }}/5</span>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Botón flotante para abrir el chat -->
  <div class="chat-fab" (click)="openChat()">
    <i class="fa-solid fa-robot"></i>
  </div>

  <!-- Modal general del chatbot -->
  <app-chatbot-modal
    [show]="showChatModal"
    [messages]="messages"
    [userInput]="userInput"
    [loading]="loadingChat"
    [sendMessage]="sendMessage.bind(this)"
    [closeChat]="closeChat.bind(this)">
  </app-chatbot-modal>
</div>
